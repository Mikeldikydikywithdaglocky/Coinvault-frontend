<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - CoinVault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/config.js"></script>
    <style>

/* ===== INLINE ERROR BANNER ===== */
.cv-inline-error {
    display: none;
    align-items: flex-start;
    gap: 0.625rem;
    padding: 0.75rem 1rem;
    border-radius: 0.625rem;
    border: 1px solid #7f1d1d;
    background: #1c0a0a;
    color: #fca5a5;
    font-size: 0.8125rem;
    line-height: 1.5;
    margin-bottom: 1rem;
    animation: cvBannerIn 0.2s ease forwards;
}
.cv-inline-error.visible {
    display: flex;
}
.cv-inline-error svg {
    flex-shrink: 0;
    margin-top: 1px;
}
.cv-inline-error-body { flex: 1; }
.cv-inline-error-title {
    font-weight: 600;
    font-size: 0.875rem;
    color: #ef4444;
    margin-bottom: 0.125rem;
}
.cv-inline-error-msg { color: #fca5a5; }
.cv-inline-error-close {
    background: none;
    border: none;
    color: #9ca3af;
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    line-height: 1;
    flex-shrink: 0;
    min-height: unset;
    transition: color 0.15s;
}
.cv-inline-error-close:hover { color: #f87171; }
@keyframes cvBannerIn {
    from { opacity: 0; transform: translateY(-6px); }
    to   { opacity: 1; transform: translateY(0); }
}



    @keyframes cvSlideOut {
        from { opacity: 1; transform: translateY(0); }
        to   { opacity: 0; transform: translateY(110%); }
    }
}

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full mx-4">
        <div class="text-center mb-6">
            <div class="flex justify-center mb-4">
                <div class="w-16 h-16 bg-indigo-600 bg-opacity-20 rounded-2xl flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </div>
            </div>
            <h1 class="text-2xl md:text-3xl font-bold mb-2">Welcome Back</h1>
            <p class="text-gray-400">Login to your CoinVault account</p>
        </div>

        <div class="bg-gray-800 rounded-2xl p-8 shadow-2xl">
            <form id="loginForm" onsubmit="handleLogin(event)">
                <!-- Email -->
                <div class="mb-6">
                    <label class="block text-sm text-gray-400 mb-2">Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        required
                        placeholder="Enter your email"
                        class="w-full bg-gray-700 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                </div>

                <!-- Password -->
                <div class="mb-6">
                    <label class="block text-sm text-gray-400 mb-2">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        required
                        placeholder="Enter your password"
                        class="w-full bg-gray-700 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                </div>

                <!-- Error Message -->
                <div id="cv-form-error" class="cv-inline-error" role="alert">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    <div class="cv-inline-error-body">
        <div class="cv-inline-error-title" id="cv-form-error-title">Error</div>
        <div class="cv-inline-error-msg" id="cv-form-error-msg"></div>
    </div>
    <button class="cv-inline-error-close" onclick="cvHideError('cv-form-error')">&times;</button>
</div>

                <!-- Success Message -->
                <div id="successMessage" class="hidden"></div>

                <!-- Login Button -->
                <button 
                    type="submit" 
                    id="loginBtn"
                    class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 py-3 rounded-xl font-bold transition mb-4"
                >
                    Login
                </button>

                <!-- Register Link -->
                <p class="text-center text-gray-400 text-sm">
                    Don't have an account? 
                    <a href="register.html" class="text-indigo-400 hover:text-indigo-300">Register here</a>
                </p>
            </form>
        </div>
    </div>

    <script>
        // API Configuration - CHANGE THIS TO YOUR BACKEND URL
        

        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const errorMsg = document.getElementById('errorMessage');
            const successMsg = document.getElementById('successMessage');

            // Hide previous messages
            cvHideError('cv-form-error');
            document.getElementById('successMessage') && document.getElementById('successMessage').classList.add('hidden');

            // Validation
            if (!email || !password) {
                showError('Please fill in all fields');
                return;
            }

            // Disable button and show loading
            loginBtn.disabled = true;
            loginBtn.textContent = 'Logging in...';

            try {
    const data = await CONFIG.apiRequest('/auth/login', {
        method: 'POST',
        body: { email, password },
        auth: false
    });

    if (data.success) {
        // Save to localStorage
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));

        // Show success
        showSuccess('Login successful! Redirecting...');

        // Redirect to dashboard
        setTimeout(() => {
            window.location.href = 'index.html';
        }, 1000);
    } else {
        showError(data.message || 'Login failed');
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
    }
} catch (error) {
    console.error('Login error:', error);
    showError(error.message || 'Network error. Please try again.');
    loginBtn.disabled = false;
    loginBtn.textContent = 'Login';
}
        }

        function showError(message) { cvShowError(message, 'Login Failed', 'cv-form-error'); }

        function showSuccess(message) {
    var el = document.getElementById('successMessage');
    if (el) { el.textContent = message; el.classList.remove('hidden'); }
}

        // Check if already logged in
        window.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            if (token) {
                window.location.href = 'index.html';
            }
        });
    </script>

<script>
// ===== INLINE ERROR BANNER SYSTEM =====
var _cvErrorTarget = null; // set per-form context

function cvShowError(message, title, containerId) {
    var bannerId = containerId || 'cv-form-error';
    var banner = document.getElementById(bannerId);
    if (!banner) {
        // Create and prepend to nearest form if no dedicated container
        banner = document.createElement('div');
        banner.id = bannerId;
        banner.className = 'cv-inline-error';
        banner.innerHTML =
            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>' +
            '<div class="cv-inline-error-body"><div class="cv-inline-error-title" id="' + bannerId + '-title"></div><div class="cv-inline-error-msg" id="' + bannerId + '-msg"></div></div>' +
            '<button class="cv-inline-error-close" onclick="cvHideError(\'' + bannerId + '\')">&times;</button>';
        var form = document.querySelector('form') || document.querySelector('.bg-gray-800') || document.body;
        form.insertBefore(banner, form.firstChild);
    }
    var titleEl = banner.querySelector('.cv-inline-error-title') || document.getElementById(bannerId + '-title');
    var msgEl   = banner.querySelector('.cv-inline-error-msg')   || document.getElementById(bannerId + '-msg');
    if (titleEl) titleEl.textContent = title || 'Error';
    if (msgEl)   msgEl.textContent   = message;
    banner.classList.add('visible');
    banner.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function cvHideError(containerId) {
    var bannerId = containerId || 'cv-form-error';
    var banner = document.getElementById(bannerId);
    if (banner) banner.classList.remove('visible');
}

// Convenience aliases matching what pages call
function cvError(msg, title, cid)   { cvShowError(msg, title || 'Error', cid); }
function cvWarning(msg, title, cid) { cvShowError(msg, title || 'Warning', cid); }
function cvInfo(msg, title, cid)    { cvShowError(msg, title || 'Notice', cid); }
</script>
</body>
</html>